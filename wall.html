<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>照片墙</title>
    <style>
        body {
            font-family: Arial, sans-serif;
        }
        .bubble {
            margin: auto;
            display: block;
        }
        .node {
            cursor: pointer;
        }
        .node circle {
            fill: #ccc;
            stroke: #999;
            stroke-width: 2px;
        }
    </style>
    <script src="https://d3js.org/d3.v3.min.js"></script>
</head>
<body>
    <svg class="bubble"></svg>
    
    <script>
        var width = 960,
            height = 960;

        var bubble = d3.layout.pack()
            .sort(null)
            .size([width, height])
            .padding(10)
            .value(function(d) {
                return d.trackers;
            });

        var svg = d3.select(".bubble")
            .attr("width", width)
            .attr("height", height);

        d3.json("assets/photos/popular.json", function(error, data) {
            if (error) throw error;

            data = data.map(function(d) {
                d.trackers = +d.trackers;
                return d;
            });

            var nodes = bubble.nodes({ children: data })
                .filter(function(d) { return !d.children; });

            var force = d3.layout.force()
                .nodes(nodes)
                .links([])
                .charge(-400)
                .gravity(0.2)
                .friction(0.8)
                .size([width, height])
                .on("tick", tick);

            force.start();

            var node = svg.selectAll(".node")
                .data(nodes)
                .enter().append("g")
                .attr("class", "node")
                .attr("transform", function(d) { return "translate(" + d.x + "," + d.y + ")"; })
                .call(force.drag);

            node.append("svg:image")
                .attr('width', function(d) { return d.r * 2; })
                .attr('height', function(d) { return d.r * 2; })
                .attr('x', function(d) { return -d.r; })
                .attr('y', function(d) { return -d.r; })
                .attr('xlink:href', function(d) { 
                    return "photo/" + d.filename; 
                });

            node.append("circle")
                .attr('r', function(d) { return d.r; });

            function tick(e) {
                var k = .1 * e.alpha;
                nodes.forEach(function(o, i) {
                    o.y += (height / 2 - o.y) * k;
                    o.x += (width / 2 - o.x) * k;
                });
                node.attr("transform", function(d) {
                    return "translate(" + d.x + "," + d.y + ")";
                });
            }
        });
    </script>
</body>
</html>
